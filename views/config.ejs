<section>
  <div class="section-title">
    <h1 class="title">Configuration</h1>
    <div>
      <span class="tag">Guild: <%= gid %></span>
      <span class="tag">Admins only</span>
    </div>
  </div>

  <!-- Vendors -->
  <div class="card" style="margin-bottom:16px">
    <div class="card head">
      <div>Vendeurs</div>
    </div>
    <div class="form-row">
      <input id="vendorId" class="input" placeholder="ID discord (optionnel)">
      <input id="vendorLabel" class="input" placeholder="Nom / label (obligatoire)">
      <button id="addVendor" class="btn btn-primary">Ajouter</button>
    </div>
    <div class="table" style="margin-top:12px">
      <% (vendors||[]).forEach(v => { %>
        <div class="row">
          <div><strong><%- v.label %></strong> <span class="muted"><%- v.id ? '('+v.id+')' : '' %></span></div>
          <div class="actions">
            <button class="btn btn-outline" data-remove-vendor="<%- v.id || v.label %>">Supprimer</button>
          </div>
        </div>
      <% }) %>
    </div>
  </div>

  <!-- Items -->
  <div class="card" style="margin-bottom:16px">
    <div class="card head"><div>Items</div></div>
    <div class="form-row">
      <input id="itemName" class="input" placeholder="Nom de l'item">
      <button id="addItem" class="btn btn-primary">Ajouter</button>
    </div>
    <div class="table" style="margin-top:12px">
      <% (items||[]).forEach(it => { %>
        <div class="row">
          <div><%- it %></div>
          <div class="actions">
            <button class="btn btn-outline" data-remove-item="<%- it %>">Supprimer</button>
          </div>
        </div>
      <% }) %>
    </div>
  </div>

  <!-- Payments -->
  <div class="card">
    <div class="card head"><div>Moyens de paiement</div></div>
    <div class="form-row">
      <input id="payName" class="input" placeholder="Nom du moyen de paiement">
      <button id="addPay" class="btn btn-primary">Ajouter</button>
    </div>
    <div class="table" style="margin-top:12px">
      <% (payments||[]).forEach(p => { %>
        <div class="row">
          <div><%- p %></div>
          <div class="actions">
            <button class="btn btn-outline" data-remove-pay="<%- p %>">Supprimer</button>
          </div>
        </div>
      <% }) %>
    </div>
  </div>
</section>

<script>
async function postJSON(url, body){
  const res = await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
  const json = await res.json();
  if(!res.ok) throw new Error(json.message||'Erreur');
  return json;
}

document.getElementById('addVendor')?.addEventListener('click', async ()=>{
  const id = document.getElementById('vendorId').value.trim();
  const label = document.getElementById('vendorLabel').value.trim();
  if(!label){ alert('Le label est obligatoire.'); return; }
  try{ await postJSON('/api/config/vendor/add',{id,label}); location.reload(); }catch(e){ alert('❌ '+e.message); }
});

document.querySelectorAll('[data-remove-vendor]')?.forEach(btn=>{
  btn.addEventListener('click', async ()=>{
    const key = btn.getAttribute('data-remove-vendor');
    try{ await postJSON('/api/config/vendor/remove',{key}); location.reload(); }catch(e){ alert('❌ '+e.message); }
  });
});

document.getElementById('addItem')?.addEventListener('click', async ()=>{
  const name = document.getElementById('itemName').value.trim();
  if(!name){ alert("Entrez un nom d'item"); return; }
  try{ await postJSON('/api/config/item/add',{name}); location.reload(); }catch(e){ alert('❌ '+e.message); }
});

document.querySelectorAll('[data-remove-item]')?.forEach(btn=>{
  btn.addEventListener('click', async ()=>{
    const name = btn.getAttribute('data-remove-item');
    try{ await postJSON('/api/config/item/remove',{name}); location.reload(); }catch(e){ alert('❌ '+e.message); }
  });
});

document.getElementById('addPay')?.addEventListener('click', async ()=>{
  const name = document.getElementById('payName').value.trim();
  if(!name){ alert('Entrez un moyen de paiement'); return; }
  try{ await postJSON('/api/config/payment/add',{name}); location.reload(); }catch(e){ alert('❌ '+e.message); }
});

document.querySelectorAll('[data-remove-pay]')?.forEach(btn=>{
  btn.addEventListener('click', async ()=>{
    const name = btn.getAttribute('data-remove-pay');
    try{ await postJSON('/api/config/payment/remove',{name}); location.reload(); }catch(e){ alert('❌ '+e.message); }
  });
});
</script>
